<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Absensi Barcode — Supabase</title>

  <!-- (Opsional) Font & Reset kecil -->
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #f6f7fb; color: #1f2937; }
    header, footer { background: #111827; color: #f9fafb; }
    header { padding: 12px 16px; border-bottom: 1px solid #111; }
    main { padding: 16px; max-width: 1200px; margin: 0 auto; }
    .wrap { display: grid; gap: 16px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .row > * { margin-right: 8px; }
    .btn { padding: 8px 12px; border-radius: 8px; border: 1px solid #d1d5db; background: #f3f4f6; cursor: pointer; }
    .btn[disabled] { opacity: .5; cursor: not-allowed; }
    .btn.primary { background: #2563eb; border-color: #1d4ed8; color: #fff; }
    .btn.warn { background: #f59e0b; border-color: #d97706; color: #111; }
    .field { display: inline-flex; align-items: center; gap: 6px; }
    .field input, .field select { padding: 8px 10px; border: 1px solid #d1d5db; border-radius: 8px; background: #fff; }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; border: 1px solid #e5e7eb; background: #f9fafb; font-size: 12px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1.4fr; gap: 16px; }
    .muted { color: #6b7280; font-size: 12px; }
    table { width: 100%; border-collapse: collapse; }
    thead th { text-align: left; background: #f3f4f6; font-weight: 600; }
    th, td { padding: 10px 12px; border-bottom: 1px solid #e5e7eb; }
    tr.highlight { background: #ecfeff; }
    .right { margin-left: auto; }
    dialog { border: none; border-radius: 12px; padding: 0; max-width: 520px; width: calc(100% - 32px); }
    dialog .card { border: none; }
    .toast { position: fixed; right: 16px; bottom: 16px; background: #111827; color: #fff; padding: 10px 14px; border-radius: 10px; display: none; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
    video { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; }
    .table-tools { display: flex; gap: 8px; align-items: center; }
  </style>

  <!-- Library (dipanggil di bawah saat implementasi) -->
  <!-- <script src="https://unpkg.com/@zxing/library@latest"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@latest/dist/umd/supabase.min.js"></script> -->
</head>
<body>
  <header>
    <div class="row" role="banner" aria-label="Header">
      <strong>Absensi Siswa — Pindai Barcode</strong>
      <span class="badge" id="badge-env" title="Status koneksi Supabase">Offline</span>
      <span class="badge" id="badge-camera" title="Status kamera">Kamera: nonaktif</span>
      <span class="right muted" id="clock" aria-live="polite">--:--</span>
    </div>
  </header>

  <main>
    <section class="wrap" aria-label="Panel Kontrol">
      <div class="card">
        <div class="row">
          <div class="field">
            <label for="project-url">Project URL</label>
            <input id="project-url" name="project-url" type="url" placeholder="https://xxxx.supabase.co" autocomplete="off" />
          </div>
          <div class="field" style="min-width: 340px;">
            <label for="anon-key">Anon Key</label>
            <input id="anon-key" name="anon-key" type="password" placeholder="SUPABASE_ANON_KEY" />
          </div>

          <button class="btn primary" id="btnConnect" aria-controls="badge-env">Sambungkan Supabase</button>
          <button class="btn" id="btnDisconnect">Putuskan</button>

          <span class="badge" id="sync-indicator" title="Sinkronisasi data">Sync idle</span>
        </div>
        <div class="row" style="margin-top: 8px;">
          <button class="btn primary" id="btnStart" aria-controls="preview">Mulai Scan</button>
          <button class="btn" id="btnStop">Stop Scan</button>

          <div class="field">
            <label for="cameraSelect">Kamera</label>
            <select id="cameraSelect" name="cameraSelect" aria-label="Pilih kamera"></select>
          </div>

          <div class="field">
            <label for="manualInput">Input Manual</label>
            <input id="manualInput" name="manualInput" type="text" inputmode="numeric" placeholder="Masukkan NIS / Kode" />
          </div>
          <button class="btn" id="btnSubmitManual">Submit</button>

          <span class="right muted">Tip: tekan <kbd>Enter</kbd> untuk submit manual.</span>
        </div>
      </div>
    </section>

    <section class="grid-2" aria-label="Scanner & Ringkasan">
      <div class="card" aria-labelledby="scanner-title">
        <h2 id="scanner-title" class="sr-only">Pratinjau Scanner</h2>
        <video id="preview" playsinline muted></video>
        <div class="row" style="margin-top: 8px;">
          <div class="badge" id="last-scan">Terakhir: —</div>
          <div class="badge" id="match-status">Status: —</div>
          <div class="badge" id="absen-mode">Mode: Masuk</div>
          <button class="btn warn" id="btnToggleMode" aria-controls="absen-mode">Ganti ke Pulang</button>
        </div>
      </div>

      <div class="card" aria-labelledby="ringkasan-title">
        <h2 id="ringkasan-title">Ringkasan Hari Ini</h2>
        <div class="row">
          <div class="badge" id="count-masuk">Masuk: 0</div>
          <div class="badge" id="count-pulang">Pulang: 0</div>
          <div class="badge" id="count-unique">Unik: 0</div>
          <div class="right table-tools">
            <div class="field">
              <input id="search" type="search" placeholder="Cari nama / ID…" aria-label="Pencarian" />
            </div>
            <div class="field">
              <label for="filterKelas">Kelas</label>
              <select id="filterKelas">
                <option value="">Semua</option>
              </select>
            </div>
            <button class="btn" id="btnExport">Export CSV</button>
            <button class="btn" id="btnClear">Bersihkan Tabel</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" aria-label="Tabel Absensi">
      <div class="row" style="margin-bottom: 8px;">
        <strong>Data Absensi</strong>
        <span class="badge">Tanggal: <span id="tanggal-hari-ini">—</span></span>
        <span class="badge">Total Baris: <span id="total-rows">0</span></span>
      </div>

      <div style="overflow:auto;">
        <table aria-describedby="tabel-keterangan">
          <caption id="tabel-keterangan" class="sr-only">
            Tabel absensi siswa yang memuat kolom nomor, ID siswa, nama, kelas, jam masuk, jam pulang, status, dan keterangan.
          </caption>
          <thead>
            <tr>
              <th style="width:64px;">No.</th>
              <th>ID Siswa</th>
              <th>Nama</th>
              <th>Kelas</th>
              <th>Jam Masuk</th>
              <th>Jam Pulang</th>
              <th>Status</th>
              <th>Keterangan</th>
            </tr>
          </thead>
          <tbody id="tbody-absen">
            <!-- Baris data di-render via template -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <div class="row" style="padding: 10px 16px;">
      <span class="muted">© <span id="year"></span> Sistem Absensi Barcode — Supabase</span>
      <span class="right muted" id="version">v0.0.0</span>
    </div>
  </footer>

  <!-- TEMPLATES -->
  <template id="row-template">
    <tr>
      <td class="col-no"></td>
      <td class="col-id"></td>
      <td class="col-nama"></td>
      <td class="col-kelas"></td>
      <td class="col-jam-masuk"></td>
      <td class="col-jam-pulang"></td>
      <td class="col-status"></td>
      <td class="col-ket"></td>
    </tr>
  </template>

  <!-- DIALOG: Konfirmasi Absen Pulang -->
  <dialog id="dlgPulang">
    <div class="card">
      <h3>Konfirmasi Absen Pulang</h3>
      <p id="dlgPulangText" class="muted">Pastikan data yang diabsen sudah benar.</p>
      <div class="row" style="margin-top: 8px;">
        <button class="btn" id="btnCancelPulang">Batal</button>
        <button class="btn primary right" id="btnOkPulang">Lanjut</button>
      </div>
    </div>
  </dialog>

  <!-- TOAST -->
  <div id="toast" class="toast" role="status" aria-live="polite">Tersimpan.</div>

  <!-- STRUKTUR ID/ELEMEN UNTUK IMPLEMENTASI LOGIKA -->
  <!--
    Supabase:
      - #project-url, #anon-key, #btnConnect, #btnDisconnect, #badge-env, #sync-indicator
      - Tabel yang terlibat (contoh): public.siswa (id, nama, kelas), public.absensi (siswa_id, tgl, jam_masuk, jam_pulang, status, ket)
    Scanner:
      - #btnStart, #btnStop, #cameraSelect, #preview, #last-scan, #match-status
    Mode:
      - #absen-mode, #btnToggleMode (Masuk/Pulang)
    Tabel:
      - #tbody-absen dengan <template id="row-template">
      - Kolom: No, ID Siswa, Nama, Kelas, Jam Masuk, Jam Pulang, Status, Keterangan
      - Kontrol: #search, #filterKelas, #btnExport, #btnClear
    Dialog & Toast:
      - #dlgPulang, #btnOkPulang, #btnCancelPulang, #toast
    Lain:
      - #clock, #tanggal-hari-ini, #total-rows, #year, #version
  -->

  <!-- HOOKS SCRIPT (isi saat implementasi) -->
  <!--
  <script>
    // 1) Init jam & tanggal
    // 2) Koneksi Supabase (window.supabase = createClient(url, key))
    // 3) Load master siswa -> cache Map(id -> {nama, kelas})
    // 4) ZXing BrowserMultiFormatReader untuk kamera & decode
    // 5) On hasil scan/manual:
    //    - Cocokkan ID di cache siswa
    //    - Tentukan mode (Masuk/Pulang), validasi duplikat di hari yang sama (cek absensi)
    //    - Tampilkan hasil di #match-status dan render/ubah baris di #tbody-absen
    //    - Simpan ke tabel absensi via supabase.from('absensi').upsert(...)
    // 6) Realtime (opsional): channel.on('postgres_changes', ...) untuk update tabel
    // 7) Export CSV dari isi tabel; Clear untuk reset tampilan (tanpa hapus DB)
  </script>
  -->
</body>
</html>
