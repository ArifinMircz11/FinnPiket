<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Barcode Siswa</title>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; text-align: center; }
    h1 { color: #2c3e50; }
    video { width: 90%; max-width: 480px; border: 4px solid #3498db; border-radius: 12px; margin: 20px 0; }
    table { width: 95%; margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #3498db; color: white; }
    tr:nth-child(even) { background: #ecf0f1; }
    #result { font-weight: bold; margin: 10px; color: #27ae60; }
    #debug { color: #e67e22; }
    .toolbar button { margin: 5px; padding: 8px 12px; border: none; border-radius: 6px; background: #3498db; color: white; cursor: pointer; }
    .toolbar button:hover { background: #2980b9; }
  </style>
</head>
<body>
  <h1>📷 Absensi Barcode</h1>

  <!-- Toolbar kegiatan -->
  <div class="toolbar">
    <button onclick="setMode('checkin')">Check In</button>
    <button onclick="setMode('duha')">Duha</button>
    <button onclick="setMode('zuhur')">Zuhur</button>
    <button onclick="setMode('checkout')">Check Out</button>
  </div>

  <video id="video" playsinline autoplay></video>
  <p id="result">Menunggu scan...</p>
  <p id="debug"></p>

  <table>
    <thead>
      <tr>
        <th>NISN</th>
        <th>Nama</th>
        <th>Kelas</th>
        <th>Jam Masuk</th>
        <th>Jam Pulang</th>
        <th>Check In</th>
        <th>Duha</th>
        <th>Zuhur</th>
        <th>Check Out</th>
        <th>Terlambat</th>
      </tr>
    </thead>
    <tbody id="absen-table"></tbody>
  </table>

<script>
  const videoElement = document.getElementById("video");
  const resultEl = document.getElementById("result");
  const debugEl = document.getElementById("debug");
  const tableBody = document.getElementById("absen-table");

  const codeReader = new ZXing.BrowserMultiFormatReader();
  let lastScanned = "";
  let lastScanTime = 0;
  const SCAN_COOLDOWN_MS = 3000; // 3 detik

  // mode absensi (default Check In)
  let currentMode = "checkin";
  function setMode(mode) {
    currentMode = mode;
    resultEl.textContent = "Mode aktif: " + mode.toUpperCase();
  }

  // data siswa default (bisa disesuaikan dari Excel)
  const siswaData = {
  "24001": { nama: "ACHMAD ULYA RAZAN", kelas: "10 A" },
"24002": { nama: "ADELLA KHAIRUNNISA", kelas: "10 A" },
"24003": { nama: "AGNIA KAMILA NORRAHMAN", kelas: "10 A" },
"24004": { nama: "AHMAD AKHTAR ADRI AFANDI", kelas: "10 A" },
"24005": { nama: "AHMAD AL HAFIZY", kelas: "10 A" },
"24006": { nama: "AHMAD ALFAREZI", kelas: "10 A" },
"24007": { nama: "AHMAD ALIF EL HAFIZH", kelas: "10 A" },
"24008": { nama: "AHMAD FAHREZI", kelas: "10 A" },
"24009": { nama: "AHMAD FAUZAN ZAKI", kelas: "10 A" },
"24010": { nama: "AHMAD FIQRI", kelas: "10 A" },
"24011": { nama: "AHMAD HABIBI", kelas: "10 A" },
"24012": { nama: "AHMAD MUZAKKIR WAHAB", kelas: "10 A" },
"24013": { nama: "AHMAD ZIDANI NUZULI", kelas: "10 A" },
"24014": { nama: "AIDIL ANSAR", kelas: "10 A" },
"24015": { nama: "AINA REHANA", kelas: "10 A" },
"24016": { nama: "AKHMAD HABIBIE", kelas: "10 A" },
"24017": { nama: "AKHMAD MUZAKKIR", kelas: "10 A" },
"24018": { nama: "AKHMAD NORHAKIM", kelas: "10 A" },
"24019": { nama: "AKHMAD RIFA'I", kelas: "10 A" },
"24020": { nama: "AKHMED RAGIL NUZULI", kelas: "10 A" },
"24021": { nama: "AKRAM PANDYA BRATADIKARA", kelas: "10 A" },
"24022": { nama: "AL FIRDA ZATUN AZKIA", kelas: "10 A" },
"24023": { nama: "ALIEF AHMAD", kelas: "10 A" },
"24024": { nama: "ALIEF HUSSEIN FIRDAUS", kelas: "10 A" },
"24025": { nama: "ALLIA NORJANNAH", kelas: "10 A" },
"24026": { nama: "ALMA SYAHRIDA", kelas: "10 A" },
"24027": { nama: "ALYA AZALEA HUMAIRA", kelas: "10 A" },
"24028": { nama: "ALYA RASIKHAH ZAHWAH", kelas: "10 A" },
"24029": { nama: "AMELIA AZIZAH", kelas: "10 A" },
"24030": { nama: "AMELIA RAHMANIAH", kelas: "10 A" },
"24031": { nama: "ANDI YUDHA CHANDRA WIRATAMA", kelas: "10 A" },
"24032": { nama: "ANDINI PUTRI", kelas: "10 A" },
"24033": { nama: "ANIDA RAHMAH", kelas: "10 A" },
"24034": { nama: "ANIN DITA APRILA WIJAYA", kelas: "10 A" },
"24035": { nama: "ANNA ALTHAFUNNISA", kelas: "10 A" },
"24036": { nama: "ANNAS TASHA", kelas: "10 A" },
"24037": { nama: "ANNIDA NORHAYAT", kelas: "10 A" },
"24038": { nama: "ANNISA KAMAL", kelas: "10 A" },
"24039": { nama: "ANNISA NAJIBA", kelas: "10 A" },
"24040": { nama: "ANNISA NUR AULIA", kelas: "10 A" },
"24041": { nama: "ANNISSA RAHMAN", kelas: "10 A" },
"24042": { nama: "APRILIA WULANDARI", kelas: "10 A" },
"24043": { nama: "ARIFA AZIZAH", kelas: "10 A" },
"24044": { nama: "ASSYIFATUZ ZAHRA", kelas: "10 A" },
"24045": { nama: "ASYIFA MAURA", kelas: "10 A" },
"24046": { nama: "ASY-SYIFA MELIA", kelas: "10 A" },
"24047": { nama: "AULADINA SALSABELA", kelas: "10 A" },
"24048": { nama: "AULIA NOR ASYIFA", kelas: "10 A" },
"24049": { nama: "AULIA NUR ASIFA", kelas: "10 A" },
"24050": { nama: "AULIA RAHMAH", kelas: "10 A" },
"24051": { nama: "AUNIKA HILYA AZKIA", kelas: "10 A" },
"24052": { nama: "BALQIS LARASATI HADRIYANTO", kelas: "10 A" },
"24053": { nama: "DAFI RASIKH", kelas: "10 A" },
"24054": { nama: "DAYANG AULIA PUTRI", kelas: "10 A" },
"24055": { nama: "DEA SHOFIA", kelas: "10 A" },
"24056": { nama: "DENY NORAIDI", kelas: "10 A" },
"24057": { nama: "DESSY AMELIA", kelas: "10 A" },
"24058": { nama: "DESY ULAN SARI", kelas: "10 A" },
"24059": { nama: "DEWINDA SARAH CLARISSA", kelas: "10 A" },
"24060": { nama: "DHEA FITRINA", kelas: "10 A" },
"24061": { nama: "DINDA NUR FAIZA", kelas: "10 A" },
"24062": { nama: "DINI PURNAMA RAMADHANI", kelas: "10 A" },
"24063": { nama: "EMARATUL HUDA", kelas: "10 A" },
"24064": { nama: "EVA ADINDA RAMADHANI", kelas: "10 A" },
"24065": { nama: "FADHILA SALSABILA", kelas: "10 A" },
"24066": { nama: "FADYA RAHMAH", kelas: "10 A" },
"24067": { nama: "FAIZIA ALYA CITRA", kelas: "10 A" },
"24068": { nama: "FAJAR", kelas: "10 A" },
"24069": { nama: "FATHIMATUZZAHRA", kelas: "10 A" },
"24070": { nama: "FATIMATUZZAHRA (HM)", kelas: "10 A" },
"24071": { nama: "FATIMATUZZAHRA (HN)", kelas: "10 A" },
"24072": { nama: "FAUZAN HAYUN", kelas: "10 A" },
"24073": { nama: "FEBRI ANNISA DANIAL", kelas: "10 A" },
"24074": { nama: "FHAHRINA MAIMUNATI", kelas: "10 A" },
"24075": { nama: "FIBIA FIRAHMANIAN", kelas: "10 A" },
"24076": { nama: "FITRAHUL HASANAH", kelas: "10 A" },
"24077": { nama: "FITRIA NUR HANIFA", kelas: "10 A" },
"24078": { nama: "GINA RAHMATIKA PUTRI", kelas: "10 A" },
"24079": { nama: "GINA SAJIDA", kelas: "10 A" },
"24080": { nama: "GT.M.ZAKY MUKADAM", kelas: "10 A" },
"24081": { nama: "GUSTI MUHAMMAD RIDHO ALDIANSYAH", kelas: "10 A" },
"24082": { nama: "HALISA", kelas: "10 A" },
"24083": { nama: "HANIFA ZALFA PUTRI SURYA", kelas: "10 A" },
"24084": { nama: "HELYATI SHAFARINA", kelas: "10 A" },
"24085": { nama: "HUMAIRAH", kelas: "10 A" },
"24086": { nama: "HUSNATUL FITRIAH", kelas: "10 A" },
"24087": { nama: "HUSNATUL HASANAH", kelas: "10 A" },
"24088": { nama: "IFNI RAFIP SYAHI", kelas: "10 A" },
"24089": { nama: "IMELDA SARI", kelas: "10 A" },
"24090": { nama: "INDAH HANDAYANI", kelas: "10 A" },
"24091": { nama: "ISTIQAMAH FITRIANI", kelas: "10 A" },
"24092": { nama: "JAHRI FADLI ALAMSYAH", kelas: "10 A" },
"24093": { nama: "KEYLA ZAHRA KHAIRUNNISA", kelas: "10 A" },
"24094": { nama: "KHAWARIZMI ANAQIN PASHA", kelas: "10 A" },
"24095": { nama: "LAILA RAHMAH", kelas: "10 A" },
"24096": { nama: "LILYANA WIDYA ACHORI", kelas: "10 A" },
"24097": { nama: "LUTFIA RAHMADINA", kelas: "10 A" },
"24098": { nama: "LUTFIA RAHMADINA", kelas: "10 A" },
"24099": { nama: "LUTFIA SORAYA", kelas: "10 A" },
"24100": { nama: "LUTHFINA", kelas: "10 A" },
"24101": { nama: "LUTHFULLAH", kelas: "10 A" },
"24102": { nama: "M.ATHAILAH", kelas: "10 A" },
"24103": { nama: "M. LUTFI SETIAWAN", kelas: "10 A" },
"24104": { nama: "M.DENIS AL FAREZA", kelas: "10 A" },
"24105": { nama: "M.HELMI HAMZAH", kelas: "10 A" },
"24106": { nama: "MAFAZATUN NAFISAH", kelas: "10 A" },
"24107": { nama: "MAHESA YUDISTIRA TANJUNG", kelas: "10 A" },
"24108": { nama: "MAS ABYAN FARRAS SUTADI SASTRA", kelas: "10 A" },
"24109": { nama: "MAULIDA SAPETRI", kelas: "10 A" },
"24110": { nama: "MAYANG SEPTYANI DWIJAYANTI", kelas: "10 A" },
"24111": { nama: "MEHLIKA NUR AFISYA", kelas: "10 A" },
"24112": { nama: "MELDYNA DWI ARIANTI", kelas: "10 A" },
"24113": { nama: "MELINDAWATI", kelas: "10 A" },
"24114": { nama: "MIA RAHMAWATI", kelas: "10 A" },
"24115": { nama: "MIFTHA REZKA NABILA", kelas: "10 A" },
"24116": { nama: "MIRA ANDINI", kelas: "10 A" },
"24117": { nama: "MIRA ASSYIFA NADIA", kelas: "10 A" },
"24118": { nama: "MIRATUS SA'ADAH", kelas: "10 A" },
"24119": { nama: "MUFIDATUZZAHRA", kelas: "10 A" },
"24120": { nama: "MUHAMAD DENI WARDHANI", kelas: "10 A" },
"24121": { nama: "MUHAMMAD ADITYA RIZKY RAMADHAN", kelas: "10 A" },
"24122": { nama: "MUHAMMAD AIDIL ADHA RAHMATULLAH", kelas: "10 A" },
"24123": { nama: "MUHAMMAD ALDIYANSYAH", kelas: "10 A" },
"24124": { nama: "MUHAMMAD ALFIN FAIZ", kelas: "10 A" },
"24125": { nama: "MUHAMMAD ALMER FAIQ", kelas: "10 A" },
"24126": { nama: "MUHAMMAD ANDRA MAULANA", kelas: "10 A" },
"24127": { nama: "MUHAMMAD ARIF RAHMAN", kelas: "10 A" },
"24128": { nama: "MUHAMMAD ARYA RAFKA", kelas: "10 A" },
"24129": { nama: "MUHAMMAD AULIA AKBAR", kelas: "10 A" },
"24130": { nama: "MUHAMMAD BAHRUL JALAL", kelas: "10 A" },
"24131": { nama: "MUHAMMAD BA'IYDMIN ZALZALAH", kelas: "10 A" },
"24132": { nama: "MUHAMMAD BINTANG ANUGERAH", kelas: "10 A" },
"24133": { nama: "MUHAMMAD CHOLID", kelas: "10 A" },
"24134": { nama: "MUHAMMAD DANDI HABIBI", kelas: "10 A" },
"24135": { nama: "MUHAMMAD DANISH", kelas: "10 A" },
"24136": { nama: "MUHAMMAD ELMI", kelas: "10 A" },
"24137": { nama: "MUHAMMAD FAHRIZA", kelas: "10 A" },
"24138": { nama: "MUHAMMAD FAIRUZ AKBAR", kelas: "10 A" },
"24139": { nama: "MUHAMMAD FAISAL", kelas: "10 A" },
"24140": { nama: "MUHAMMAD FARDIN IKRAM", kelas: "10 A" },
"24141": { nama: "MUHAMMAD FARREL AL FARISI", kelas: "10 A" },
"24142": { nama: "MUHAMMAD FATIH REZKI", kelas: "10 A" },
"24143": { nama: "MUHAMMAD FIDZA MULKIE", kelas: "10 A" },
"24144": { nama: "MUHAMMAD FIRDAUS", kelas: "10 A" },
"24145": { nama: "MUHAMMAD HABIBIE BATUAH", kelas: "10 A" },
"24146": { nama: "MUHAMMAD HADZIQI SAKHA ATHAYA", kelas: "10 A" },
"24147": { nama: "MUHAMMAD HAFIE RAHMAN", kelas: "10 A" },
"24148": { nama: "MUHAMMAD HAIKAL", kelas: "10 A" },
"24149": { nama: "MUHAMMAD HANIF RAMADHAN", kelas: "10 A" },
"24150": { nama: "MUHAMMAD HAQQIN NAJILI", kelas: "10 A" },
"24151": { nama: "MUHAMMAD HUSIN NAFARIN", kelas: "10 A" },
"24152": { nama: "MUHAMMAD IKHFATU RAYHAN", kelas: "10 A" },
"24153": { nama: "MUHAMMAD IKMAL", kelas: "10 A" },
"24154": { nama: "MUHAMMAD ILHAM RAMADHANI", kelas: "10 A" },
"24155": { nama: "MUHAMMAD KAFI RIZKI", kelas: "10 A" },
"24156": { nama: "MUHAMMAD LUTHFI HIDAYAT", kelas: "10 A" },
"24157": { nama: "MUHAMMAD LUTHFIE", kelas: "10 A" },
"24158": { nama: "MUHAMMAD LUTHFIL KHALIQ", kelas: "10 A" },
"24159": { nama: "MUHAMMAD MAHI", kelas: "10 A" },
"24160": { nama: "MUHAMMAD MUJIBURRAHMAN", kelas: "10 A" },
"24161": { nama: "MUHAMMAD NAFI IRFAN MAULANA", kelas: "10 A" },
"24162": { nama: "MUHAMMAD NAUFAL ADLY", kelas: "10 A" },
"24163": { nama: "MUHAMMAD NAUFAL AZHAR", kelas: "10 A" },
"24164": { nama: "MUHAMMAD NAUFAL RAFIF", kelas: "10 A" },
"24165": { nama: "MUHAMMAD NAZAR FADILLAH", kelas: "10 A" },
"24166": { nama: "MUHAMMAD NUR HUDA", kelas: "10 A" },
"24167": { nama: "MUHAMMAD RAFA", kelas: "10 A" },
"24168": { nama: "MUHAMMAD RAJABI", kelas: "10 A" },
"24169": { nama: "MUHAMMAD RAVA ALKHARIDZI", kelas: "10 A" },
"24170": { nama: "MUHAMMAD RAYHAN SAPUTRA", kelas: "10 A" },
"24171": { nama: "MUHAMMAD REFKY ADITYA", kelas: "10 A" },
"24172": { nama: "MUHAMMAD REZKI ADITYA", kelas: "10 A" },
"24173": { nama: "MUHAMMAD REZKI FADHILA", kelas: "10 A" },
"24174": { nama: "MUHAMMAD RIDHO", kelas: "10 A" },
"24175": { nama: "MUHAMMAD RIDHO NAUFAL", kelas: "10 A" },
"24176": { nama: "MUHAMMAD RIDHWAN", kelas: "10 A" },
"24177": { nama: "MUHAMMAD RIFA'E", kelas: "10 A" },
"24178": { nama: "MUHAMMAD RIFQI NABIL", kelas: "10 A" },
"24179": { nama: "MUHAMMAD RIFQI RAMADHANI", kelas: "10 A" },
"24180": { nama: "MUHAMMAD RIFQY ARIF FURHAN", kelas: "10 A" },
"24181": { nama: "MUHAMMAD RIZKY ADITYA", kelas: "10 A" },
"24182": { nama: "MUHAMMAD RIZKY PUTERA AKBAR", kelas: "10 A" },
"24183": { nama: "MUHAMMAD ROYYAN FAHREZA", kelas: "10 A" },
"24184": { nama: "MUHAMMAD SAHIBUL AIMAN", kelas: "10 A" },
"24185": { nama: "MUHAMMAD SALMAN AL FARIZI", kelas: "10 A" },
"24186": { nama: "MUHAMMAD SANDY HIDAYAT", kelas: "10 A" },
"24187": { nama: "MUHAMMAD SEPTIAN RAMADHANI", kelas: "10 A" },
"24188": { nama: "MUHAMMAD SUJBHAN", kelas: "10 A" },
"24189": { nama: "MUHAMMAD SYAHREZA", kelas: "10 A" },
"24190": { nama: "MUHAMMAD TAUFIQ", kelas: "10 A" },
"24191": { nama: "MUHAMMAD TONI YUSUF", kelas: "10 A" },
"24192": { nama: "MUHAMMAD YAHYA HELMY", kelas: "10 A" },
"24193": { nama: "MUHAMMAD YUSUF", kelas: "10 A" },
"24194": { nama: "MUHAMMAD ZAENAL HAKIEM", kelas: "10 A" },
"24195": { nama: "MUHAMMAD ZAIRULLAH ANDHIKA", kelas: "10 A" },
"24196": { nama: "MUHAMMAD ZULFADHLI AKBAR", kelas: "10 A" },
"24197": { nama: "MUASFIRA ALYA RAHMADHINI", kelas: "10 A" },
"24198": { nama: "MUSJALIPAH", kelas: "10 A" },
"24199": { nama: "MUTHI'ATUN NISA", kelas: "10 A" },
"24200": { nama: "MUTIA HANIEFA", kelas: "10 A" },
"24201": { nama: "MUTIA SARI", kelas: "10 A" },
"24202": { nama: "NABELLA AZ-ZAHRA", kelas: "10 A" },
"24203": { nama: "NABILA ANGGRAENI", kelas: "10 A" },
"24204": { nama: "NABILA PUTRI AZ-ZAHRA", kelas: "10 A" },
"24205": { nama: "NABILLA", kelas: "10 A" },
"24206": { nama: "NADA FAUZANA", kelas: "10 A" },
"24207": { nama: "NADIA KHAIRA", kelas: "10 A" },
"24208": { nama: "NADIA MAIMUNATURRAHMAH", kelas: "10 A" },
"24209": { nama: "NADIA RAHMANIAH", kelas: "10 A" },
"24210": { nama: "NAFIZATUL LUTFIA", kelas: "10 A" },
"24211": { nama: "NAHDIA MAHFUDZAH", kelas: "10 A" },
"24212": { nama: "NAILA ZAKIA", kelas: "10 A" },
"24213": { nama: "NAJLA NUR AZIZATUNNISA", kelas: "10 A" },
"24214": { nama: "NAJWATUN ZASKIA", kelas: "10 A" },
"24215": { nama: "NAMIRA SALSABILA FAZA", kelas: "10 A" },
"24216": { nama: "NARESA RISKIA", kelas: "10 A" },
"24217": { nama: "NAURA ZALFAKHAIRUNNISA", kelas: "10 A" },
"24218": { nama: "NAYLA AZKYA NAFISAH", kelas: "10 A" },
"24219": { nama: "NAYLA FADHILA", kelas: "10 A" },
"24220": { nama: "NAYLA FAIZA PUTRI", kelas: "10 A" },
"24221": { nama: "NAYLA MADINA", kelas: "10 A" },
"24222": { nama: "NAYRA NAZLA RAMADHANA", kelas: "10 A" },
"24223": { nama: "NAZMIATUL NOOR IZZAH", kelas: "10 A" },
"24224": { nama: "NIDA UL HUSNA", kelas: "10 A" },
"24225": { nama: "NI'MATUL UZMA", kelas: "10 A" },
"24226": { nama: "NITA ABIDAH", kelas: "10 A" },
"24227": { nama: "NIZAR FIRDAUS", kelas: "10 A" },
"24228": { nama: "NOOR FAIRASYA JANNAH", kelas: "10 A" },
"24229": { nama: "NOOR KAMELIA", kelas: "10 A" },
"24230": { nama: "NOOR KAMILAH", kelas: "10 A" },
"24231": { nama: "NOR ATINI", kelas: "10 A" },
"24232": { nama: "NOR HIDAYATI", kelas: "10 A" },
"24233": { nama: "NOR LAILI", kelas: "10 A" },
"24234": { nama: "NOR NAZAHAH", kelas: "10 A" },
"24235": { nama: "NORKHALISAH NA'IMAH", kelas: "10 A" },
"24236": { nama: "NORLAILLA SARI", kelas: "10 A" },
"24237": { nama: "NORMAWATI", kelas: "10 A" },
"24238": { nama: "NOVITA SALWA RAMADHANI", kelas: "10 A" },
"24239": { nama: "NUR ANISAH HUMAIRA", kelas: "10 A" },
"24240": { nama: "NUR ANNISA FITRI", kelas: "10 A" },
"24241": { nama: "NUR BAITI", kelas: "10 A" },
"24242": { nama: "NUR HIKMAH", kelas: "10 A" },
"24243": { nama: "NUR MUTIA DEWI", kelas: "10 A" },
"24244": { nama: "NUR SYIFA", kelas: "10 A" },
"24245": { nama: "NURHALIZAH", kelas: "10 A" },
"24246": { nama: "NURIL KAMALIA", kelas: "10 A" },
"24247": { nama: "NURUL AZKIYA", kelas: "10 A" },
"24248": { nama: "PUTRI SALSABELLA MECCA", kelas: "10 A" },
"24249": { nama: "RADIA MUFIDA", kelas: "10 A" },
"24250": { nama: "RAFERIDHO AHMAD", kelas: "10 A" },
"24251": { nama: "RAFIF AKMAL", kelas: "10 A" },
"24252": { nama: "RAHMAT ADITIYA", kelas: "10 A" },
"24253": { nama: "RAHMATUN NAZWA", kelas: "10 A" },
"24254": { nama: "RAIHAN ALIZA PRADANA", kelas: "10 A" },
"24255": { nama: "RAISA NISRINA", kelas: "10 A" },
"24256": { nama: "RANGGA SUKMA", kelas: "10 A" },
"24257": { nama: "RATNA HAFIZAH", kelas: "10 A" },
"24258": { nama: "RAYSA KAMILA", kelas: "10 A" },
"24259": { nama: "RAZQA NOUVAL ADHETIAN", kelas: "10 A" },
"24260": { nama: "RELIYANA SALSABILA", kelas: "10 A" },
"24261": { nama: "RESTU PAHLINA", kelas: "10 A" },
"24262": { nama: "RIEZQIA ASY-SYIFA ZAHRA", kelas: "10 A" },
"24263": { nama: "RIKA MULKIYAH BULKAINI", kelas: "10 A" },
"24264": { nama: "RIRIN ARIYANI", kelas: "10 A" },
"24265": { nama: "RISKA AMANDA FAUZIA", kelas: "10 A" },
"24267": { nama: "RIZKA ZAHRATUS SYA'BANI", kelas: "10 A" },
"24268": { nama: "RIZKINA AULIA NOOR", kelas: "10 A" },
"24269": { nama: "RIZQA KHUMAYRAH", kelas: "10 A" },
"24270": { nama: "ROLAND SATRIA NUGRAHA", kelas: "10 A" },
"24271": { nama: "RONA HIDAYATI", kelas: "10 A" },
"24272": { nama: "RONA KAMILIYA", kelas: "10 A" },
"24273": { nama: "RONY DWI PURNAMA", kelas: "10 A" },
"24274": { nama: "SALMAN AL-BAK", kelas: "10 A" },
"24275": { nama: "SALSA REGINA SAHYANI", kelas: "10 A" },
"24276": { nama: "SALWA AURA NURSHAFIRA", kelas: "10 A" },
"24277": { nama: "SANAINAH", kelas: "10 A" },
"24278": { nama: "SARIYATI", kelas: "10 A" },
"24279": { nama: "SHAFA NAURA KAMILAH", kelas: "10 A" },
"24280": { nama: "SHOFIATUL AZKIA", kelas: "10 A" },
"24281": { nama: "SILVIA RAHMAKH", kelas: "10 A" },
"24282": { nama: "SITI AMALIA SALIHAH", kelas: "10 A" },
"24283": { nama: "SITI AULIA RAHMAH", kelas: "10 A" },
"24284": { nama: "SITI AURELLYA", kelas: "10 A" },
"24285": { nama: "SITI NADHIRA AQILAH", kelas: "10 A" },
"24286": { nama: "SITI NAFISAH", kelas: "10 A" },
"24287": { nama: "SITI NOORKHALISA", kelas: "10 A" },
"24288": { nama: "SITI NORKHALISA WINALDA", kelas: "10 A" },
"24289": { nama: "SITI RAHMA AUFA", kelas: "10 A" },
"24290": { nama: "SITI ZAFIRAH AZ-ZAHRAA", kelas: "10 A" },
"24291": { nama: "SITI ZAIDA NOFARIANI", kelas: "10 A" },
"24292": { nama: "SRI ERMIYATI AGISTY", kelas: "10 A" },
"24293": { nama: "SRI RAHMA ANDINI", kelas: "10 A" },
"24294": { nama: "SYALFA RATU MARURI", kelas: "10 A" },
"24295": { nama: "SYIFA NOR RAHMAH", kelas: "10 A" },
"24296": { nama: "SYLVIA ARIANI AZ ZAHRA", kelas: "10 A" },
"24297": { nama: "TASYA AURELLIA", kelas: "10 A" },
"24298": { nama: "TIARA LAKSANA AZ-ZAHRA", kelas: "10 A" },
"24299": { nama: "TIARA WILDAYANI", kelas: "10 A" },
"24300": { nama: "TRI DARMA WULANDARI", kelas: "10 A" },
"24301": { nama: "WIDYA RAISYA NADHIRA", kelas: "10 A" },
"24302": { nama: "YENI NURHAYATIN", kelas: "10 A" },
"24303": { nama: "ZADHIA NAJMIA RAHMAH", kelas: "10 A" },
"24304": { nama: "ZAHRA AULIA", kelas: "10 A" },
"24305": { nama: "ZANATUL MUNIRAH", kelas: "10 A" },
"24306": { nama: "ZECINDA REGISTHA CAHYANI", kelas: "10 A" },
"24307": { nama: "ZIA ARISFA SELVIA PUTRI", kelas: "10 A" },
"24308": { nama: "SITI NORHALISAH", kelas: "10 A" },
"24309": { nama: "ZULFA RABBANIE", kelas: "10 A" },
"24310": { nama: "REGINA NUR INAYAH", kelas: "10 A" },
"24311": { nama: "SYARIFAH AZ ZAHRATUL QOLBI ASSEGAF", kelas: "10 A" }
    // tambahkan sesuai kebutuhan
  };

  // catat absensi
  function prosesAbsensi(nisn) {
    if (!siswaData[nisn]) {
      resultEl.textContent = "❌ NISN tidak terdaftar";
      return;
    }

    const siswa = siswaData[nisn];
    const waktu = new Date();
    const waktuStr = waktu.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" });

    // cari baris siswa di tabel
    let row = document.getElementById("row-" + nisn);
    if (!row) {
      row = document.createElement("tr");
      row.id = "row-" + nisn;
      row.innerHTML = `
        <td>${nisn}</td>
        <td>${siswa.nama}</td>
        <td>${siswa.kelas}</td>
        <td>07:30</td>
        <td>16:00</td>
        <td></td><td></td><td></td><td></td><td></td>
      `;
      tableBody.appendChild(row);
    }

    const cells = row.getElementsByTagName("td");

    if (currentMode === "checkin") {
      cells[5].textContent = waktuStr;
      // hitung terlambat
      if (waktu.getHours() > 7 || (waktu.getHours() === 7 && waktu.getMinutes() > 30)) {
        cells[9].textContent = "Ya";
      } else {
        cells[9].textContent = "Tidak";
      }
    } else if (currentMode === "duha") {
      cells[6].textContent = waktuStr;
    } else if (currentMode === "zuhur") {
      cells[7].textContent = waktuStr;
    } else if (currentMode === "checkout") {
      cells[8].textContent = waktuStr;
    }

    resultEl.textContent = `✅ ${siswa.nama} (${nisn}) ${currentMode} dicatat`;
  }

  // inisialisasi kamera
  codeReader.listVideoInputDevices().then(devices => {
    if (!devices.length) {
      debugEl.textContent = "❌ Kamera tidak ditemukan";
      return;
    }
    const cam = devices.find(d => d.label.toLowerCase().includes("back")) || devices[0];
    codeReader.decodeFromVideoDevice(cam.deviceId, videoElement, (resultObj, err) => {
      if (resultObj) {
        const nisn = resultObj.text.trim();
        const now = Date.now();
        if (nisn !== lastScanned || now - lastScanTime > SCAN_COOLDOWN_MS) {
          lastScanned = nisn;
          lastScanTime = now;
          prosesAbsensi(nisn);
        }
      } else if (err && !(err instanceof ZXing.NotFoundException)) {
        debugEl.textContent = "⚠️ Error scan: " + err;
      }
    });
  }).catch(err => {
    debugEl.textContent = "⚠️ Gagal akses kamera: " + err;
    console.error(err);
  });
</script>
</body>
</html>
